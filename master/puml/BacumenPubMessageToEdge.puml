@startuml
set separator none
title Bacumen - Dynamic

left to right direction

!include <C4/C4>
!include <C4/C4_Context>
!include <C4/C4_Container>

AddElementTag("Container", $bgColor="#438dd5", $borderColor="#2e6295", $fontColor="#ffffff", $sprite="", $shadowing="", $borderStyle="Solid", $borderThickness="1")

AddRelTag("Relationship", $textColor="#707070", $lineColor="#707070", $lineStyle = "")

AddBoundaryTag("Software System", $bgColor="#ffffff", $borderColor="#0b4884", $fontColor="#0b4884", $shadowing="", $borderStyle="Solid", $borderThickness="1")

System_Boundary("Bacumen_boundary", "Bacumen", $tags="Software System") {
  AddBoundaryTag("API", $borderColor="#cccccc", $fontColor="#cccccc", $borderStyle="Dashed", $borderThickness="1")
  Boundary(group_1, "API", $tags="API") {
    Container(Bacumen.APIService, "API Service", $techn="", $descr="Server", $tags="Container", $link="")
  }

}

System_Boundary("EdgeComputingPlatform_boundary", "Edge Computing Platform", $tags="Software System") {
  Container(EdgeComputingPlatform.HubDevice, "Hub Device", $techn="", $descr="Edge Hub to integrate and orchastrate data from the sensor network.", $tags="Container", $link="")
}

System_Boundary("Int2Fabric_boundary", "Int2 Fabric", $tags="Software System") {
  AddBoundaryTag("Backend Services", $borderColor="#cccccc", $fontColor="#cccccc", $borderStyle="Dashed", $borderThickness="1")
  Boundary(group_2, "Backend Services", $tags="Backend Services") {
      AddBoundaryTag("Backend Services/API Service", $borderColor="#cccccc", $fontColor="#cccccc", $borderStyle="Dashed", $borderThickness="1")
      Boundary(group_3, "API Service", $tags="Backend Services/API Service") {
        Container(Int2Fabric.APIService, "API Service", $techn="", $descr="API Gateway Managed Service", $tags="Container", $link="")
      }

      AddBoundaryTag("Backend Services/DataPipelineService", $borderColor="#cccccc", $fontColor="#cccccc", $borderStyle="Dashed", $borderThickness="1")
      Boundary(group_4, "DataPipelineService", $tags="Backend Services/DataPipelineService") {
        Container(Int2Fabric.StreamAPI, "Stream API", $techn="Container: Zenoh Backend S3", $descr="Subscribe data to store", $tags="Container", $link="")
      }

  }

}

Rel(Bacumen.APIService, Int2Fabric.APIService, "1. Regist Webhook url on subscription topic", $techn="", $tags="Relationship", $link="")
Rel(EdgeComputingPlatform.HubDevice, Int2Fabric.StreamAPI, "2. Publish message", $techn="", $tags="Relationship", $link="")
Rel(Int2Fabric.StreamAPI, Int2Fabric.APIService, "3. notify", $techn="", $tags="Relationship", $link="")
Rel(Int2Fabric.APIService, Bacumen.APIService, "4. Call webhook with message payload", $techn="", $tags="Relationship", $link="")

SHOW_LEGEND(true)
@enduml